import React from 'react';
import { View, Text, TouchableOpacity, Image, Animated } from 'react-native';
import { useNavigation, useRoute, RouteProp } from '@react-navigation/native';
import { NativeStackNavigationProp } from '@react-navigation/native-stack';

import { useAuth } from '@/context/AuthContext';
import { ManagerStackParamList } from '@/navigation/ManagerNavigator';

interface ManagerSidebarProps {
  collapsed: boolean;
  sidebarWidth: Animated.Value;
  pendingCount: number;
}

type ManagerNavProp = NativeStackNavigationProp<ManagerStackParamList>;

export const ManagerSidebar: React.FC<ManagerSidebarProps> = ({
  collapsed,
  sidebarWidth,
  pendingCount,
}) => {
  const { user } = useAuth();
  const navigation = useNavigation<ManagerNavProp>();
  const route = useRoute<RouteProp<ManagerStackParamList>>();

  const animatedStyle = { width: sidebarWidth };

  interface MenuItemProps {
    label: string;
    icon: string;
    routeName: keyof ManagerStackParamList;
    badgeCount?: number;
    marginTop?: string;
  }

  const MenuItem: React.FC<MenuItemProps> = React.memo(
    ({ label, icon = '', routeName, badgeCount = 0, marginTop = 'mt-4' }) => {
      const isActive = route.name === routeName;

      return (
        <TouchableOpacity
          onPress={() => navigation.navigate(routeName)}
          className={`mb-4 flex-row items-center justify-between ${marginTop}`}
        >
          {/* Wrap everything in a single Text */}
          <Text
            className={`text-lg ${isActive ? 'text-green-400 font-bold' : 'text-white'}`}
          >
            {`${icon} ${label}`}
          </Text>

          {badgeCount > 0 && (
            <View className="bg-red-500 rounded-full h-6 min-w-[24px] px-1 items-center justify-center">
              <Text className="text-white text-[10px] font-bold">
                {badgeCount > 99 ? '99+' : badgeCount}
              </Text>
            </View>
          )}
        </TouchableOpacity>
      );
    }
  );

  if (collapsed) return null;

  return (
    <Animated.View
      className="bg-gray-800 flex-1 p-4 justify-between"
      style={animatedStyle}
    >
      <View>
        {/* User info */}
        <View className="mt-24 mb-6">
          <Image
            source={require('./../../../assets/avatar.png')}
            className="w-16 h-16 rounded-full  mb-2"
          />
          <Text className="text-white font-bold text-lg" numberOfLines={1}>
            {user?.name || 'Manager'}
          </Text>
          <Text className="text-gray-300 text-sm" numberOfLines={1}>
            {user?.email}
          </Text>
        </View>

        {/* Menu items */}
        <View className="border-t border-gray-500 pt-8">
          <MenuItem label="Home" icon="ðŸ " routeName="ManagerHome" marginTop="mt-4" />
          <MenuItem label="Create Tasks" icon="âœï¸" routeName="CreateTasks" />
          <MenuItem label="View Tasks" icon="ðŸ‘ï¸" routeName="ViewTasks" />
          <MenuItem label="Assign Tasks" icon="â”" routeName="AssignTasks" />
          <MenuItem
            label="Review Tasks"
            icon="âœ…"
            routeName="ReviewTasks"
            badgeCount={pendingCount}
          />
        </View>
      </View>

      {/* Footer */}
      <View className="mb-4">
        <View className="border-t border-gray-500 mb-2" />
        <Text className="text-gray-400 text-center text-[10px] tracking-widest uppercase">
          Powered by CodingCops Â©
        </Text>
      </View>
    </Animated.View>
  );
};
